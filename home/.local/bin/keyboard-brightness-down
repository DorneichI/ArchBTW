#!/bin/bash

KEYBOARD_BACKLIGHT="/sys/class/leds/smc::kbd_backlight"

# ensure the following exist
[ -d "$KEYBOARD_BACKLIGHT" ] || exit 0
[ -r "$KEYBOARD_BACKLIGHT/max_brightness" ] || exit 0

# ensure command line argument is number
case "$1" in
    ''|*[!0-9-]*) echo "Usage: $0 <number>"; exit 1;
esac

DELTA="$1"
MIN_BRIGHTNESS=0
CURRENT_BRIGHTNESS=$(cat "$KEYBOARD_BACKLIGHT/brightness")

NEW_BRIGHTNESS=$((CURRENT_BRIGHTNESS - DELTA))

# ensure NEW_BRIGHTNESS is at least MIN_BRIGHTNESS
[ $NEW_BRIGHTNESS -lt $MIN_BRIGHTNESS ] && NEW_BRIGHTNESS=$MIN_BRIGHTNESS

# set new brightness
echo $NEW_BRIGHTNESS | sudo tee "$KEYBOARD_BACKLIGHT/brightness" > /dev/null
